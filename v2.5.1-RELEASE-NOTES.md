# YOLO Yacht Search v2.5.1 - CRITICAL FIX

## üéØ THE BUG IS FINALLY FIXED!

After extensive debugging and testing, the root cause has been identified and resolved.

## The Problem

The availability check was showing "Not Available" even when yachts had offers in the Booking Manager API.

## The Root Cause

**Line 350 in `class-yolo-ys-booking-manager-api.php`:**

```php
'tripDuration' => 7, // Weekly charters
```

This parameter was causing the Booking Manager API to return **HTTP 404 errors**, which made the plugin think yachts were unavailable.

## The Fix

**Removed the `tripDuration` parameter** from the `/offers` API call. The Booking Manager API automatically calculates the trip duration from the `dateFrom` and `dateTo` parameters.

### Changed Code

**Before (v2.5.0):**
```php
$params = array(
    'yachtId' => $yacht_id,
    'dateFrom' => $date_from_formatted,
    'dateTo' => $date_to_formatted,
    'tripDuration' => 7, // ‚ùå This caused HTTP 404
);
```

**After (v2.5.1):**
```php
$params = array(
    'yachtId' => $yacht_id,
    'dateFrom' => $date_from_formatted,
    'dateTo' => $date_to_formatted,
    // REMOVED: tripDuration parameter causes HTTP 404 from API
    // The API calculates duration from dateFrom/dateTo automatically
);
```

## Testing Results

### Before Fix (v2.5.0)
- API Response: HTTP 404
- Plugin Result: "Not Available"
- User Experience: ‚ùå Broken

### After Fix (v2.5.1)
- API Response: HTTP 200 with offers
- Plugin Result: Shows correct price (e.g., 3,870 EUR)
- User Experience: ‚úÖ **WORKING PERFECTLY**

## Installation

1. **Deactivate** the old plugin version
2. **Delete** the old plugin
3. **Upload** `yolo-yacht-search-v2.5.1.zip`
4. **Activate** the plugin
5. **Test** with any yacht and Saturday-to-Saturday dates

## What to Expect

‚úÖ Availability check works correctly  
‚úÖ Shows real-time prices from API  
‚úÖ "Not Available" only shows when yacht is genuinely unavailable  
‚úÖ No more false negatives  

## Technical Details

**Files Changed:**
- `includes/class-yolo-ys-booking-manager-api.php` - Removed tripDuration parameter
- `includes/class-yolo-ys-stripe-handlers.php` - Cleaned up debug code
- `yolo-yacht-search.php` - Version bump to 2.5.1

**Tested With:**
- Yacht ID: 7208135200000107850
- Dates: June 13-20, 2026
- Result: ‚úÖ Available at 3,870 EUR (10% discount)

## Credits

Bug discovered through systematic debugging by setting up a local WordPress instance and testing the API calls directly.

---

**Version:** 2.5.1  
**Release Date:** November 30, 2025  
**Critical Fix:** Yes  
**Backward Compatible:** Yes
